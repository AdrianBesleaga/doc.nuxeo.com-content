---
title: Blob Storage Configuration
review:
    comment: ''
    date: ''
    status: ok
labels:
    - binary-manager
    - lts2015-ok
    - blob-storage
    - blob-manager-component
toc: true
confluence:
    ajs-parent-page-id: '27604704'
    ajs-parent-page-title: Setup
    ajs-space-key: ADMINDOC710
    ajs-space-name: Nuxeo Installation and Administration â€” LTS 2015
    canonical: Blob+Storage+Configuration
    canonical_source: 'https://doc.nuxeo.com/display/ADMINDOC710/Blob+Storage+Configuration'
    page_id: '27604617'
    shortlink: iTalAQ
    shortlink_source: 'https://doc.nuxeo.com/x/iTalAQ'
    source_link: /display/ADMINDOC710/Blob+Storage+Configuration
tree_item_index: 600
version_override:
    'FT': /nxdoc/file-storage-configuration
history:
    -
        author: Alain Escaffre
        date: '2015-12-13 22:59'
        message: ''
        version: '15'
    -
        author: Alain Escaffre
        date: '2015-12-13 22:54'
        message: ''
        version: '14'
    -
        author: Alain Escaffre
        date: '2015-12-13 22:51'
        message: ''
        version: '13'
    -
        author: Solen Guitter
        date: '2015-11-10 08:11'
        message: Fix typo and formatting
        version: '12'
    -
        author: Alain Escaffre
        date: '2015-11-09 15:48'
        message: ''
        version: '11'
    -
        author: Alain Escaffre
        date: '2015-11-09 15:41'
        message: ''
        version: '10'
    -
        author: Solen Guitter
        date: '2015-07-01 12:07'
        message: ''
        version: '9'
    -
        author: Solen Guitter
        date: '2015-07-01 09:58'
        message: ''
        version: '8'
    -
        author: Solen Guitter
        date: '2015-07-01 09:56'
        message: ''
        version: '7'
    -
        author: Manon Lumeau
        date: '2015-06-29 12:34'
        message: ''
        version: '6'
    -
        author: Manon Lumeau
        date: '2015-06-29 09:35'
        message: ''
        version: '5'
    -
        author: Florent Guillaume
        date: '2015-06-23 13:04'
        message: link to aes
        version: '4'
    -
        author: Florent Guillaume
        date: '2015-06-23 13:03'
        message: link to S3
        version: '3'
    -
        author: Florent Guillaume
        date: '2015-06-23 13:01'
        message: "link to DefaultBinaryManager\uFEFF page"
        version: '2'
    -
        author: Florent Guillaume
        date: '2015-06-23 12:43'
        message: ''
        version: '1'

---
The blobs attached to a document in Nuxeo are usually stored separately from the main document database. The way in which they are stored is configurable using the concepts of a Binary Manager, Blob Provider and Blob Dispatcher.

{{#> callout type='info' }}

This page gives operational information on targeted configurations. For a full understanding on how Nuxeo Platform stores binaries and what possibilities are available, please read the [dedicated documentation page]({{page space='nxdoc710' page='file-storage'}}) in the main documentation section.

{{/callout}}

## Configuring the Default BlobProvider

The default blobProvider for Nuxeo Platform stores binaries on the local filesystem at a configurable location and with filenames based on their hash (digest).

{{#> panel type='code' heading='Standard DefaultBinaryManager Configuration'}}

```xml
<extension target="org.nuxeo.ecm.core.blob.BlobManager" point="configuration">
  <blobprovider name="default">
    <class>org.nuxeo.ecm.core.blob.binary.DefaultBinaryManager</class>
    <property name="path">binaries</property>
  </blobprovider>
</extension>
```

{{/panel}}

The `path` property is used to specify the filesystem path at which the binaries will be stored. A relative path will be resolved under `$NUXEO/nxserver/data`, but an absolute path can be used as well if needed.

The format of the `binaries` (or other configured path) directory is:

* `config.xml` a file containing the configuration used.
* `data/` the hierarchy with the actual binaries dispatched in subdirectories.
* `tmp/` a temporary storage location during creation (this must be on the same filesystem as `data/`).

The `config.xml` file looks like this:

```xml
<?xml version="1.0"?>
<binary-store>
  <digest>MD5</digest>
  <depth>2</depth>
</binary-store>
```

It is automatically generated by Nuxeo when initializing an empty binary storage, but you can put it manually and change the configuration:

* `digest` is a Java [MessageDigest](https://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html#MessageDigest) name, for example MD5 or SHA-256.
* `depth` is the depth with which the files are nested in subdirectories to avoid having too many in a single directory.

## Registering Another BlobProvider

To register a new blob provider, use the [`blobprovider`](http://explorer.nuxeo.com/nuxeo/site/distribution/latest/viewExtensionPoint/org.nuxeo.ecm.core.blob.BlobManager--configuration) extension point and with the class for your binary manager:

```xml
<extension target="org.nuxeo.ecm.core.blob.BlobManager" point="configuration">
  <blobprovider name="default">
    <class>org.nuxeo.ecm.core.blob.binary.DefaultBinaryManager</class>
    <property name="path">binaries</property>
  </blobprovider>
</extension>
```

You will find existing implementations in the binary store main documentation page, with links to specific configuration instructions:

* [the one that can be configured without additional addon]({{page space='nxdoc710' page='file-storage#defaultblobproviders'}})
* [the one that require installation of an addon]({{page space='nxdoc710' page='file-storage#additionalblobproviders'}}).

Usually, if you don't use the advanced Blob Dispatcher capabilities, you will need one binary manager per Nuxeo repository. By default Nuxeo uses a binary manager with the same name for each repository, for instance the "default" repository will use the "default" binary manager. For a standard Nuxeo instance with a single repository, this is all taken care of for you in the default template

## Blob Dispatcher

Without specific configuration, the&nbsp;`DefaultBlobDispatcher`&nbsp;stores a document's blob's binary in a blob provider with the same name as the document's repository name.

Advanced dispatching configuration are possible using properties. Each property name is a list of comma-separated clauses, with each clause consisting of a property, an operator and a value. The property can be a document XPath,&nbsp; `ecm:repositoryName` , or, to match the current blob being dispatched,&nbsp; `blob:name` ,&nbsp; `blob:mime-type` ,&nbsp; `blob:encoding` ,&nbsp; `blob:digest` &nbsp;or&nbsp; `blob:length` . Comma-separated clauses are ANDed together. The special name&nbsp;`default`&nbsp;defines the default provider, and&nbsp;**must**&nbsp;be present. Available operators between property and value are&nbsp;`=`,&nbsp;`!=`,&nbsp;`<`, and&nbsp;`>`.

For example, all the videos could be stored somewhere, the documents from a secret source in an encrypted area, and the rest in a third location. To do this, you would need to specify the following:

{{#> panel type='code' heading='Example Blob Dispatcher Configuration'}}

```xml
<extension target="org.nuxeo.ecm.core.blob.BlobManager" point="configuration">
  <blobdispatcher>
    <class>org.nuxeo.ecm.core.blob.DefaultBlobDispatcher</class>
    <property name="dc:format=video">videos</property>
    <property name="blob:mime-type=video/mp4">videos</property>
    <property name="dc:source=secret">encrypted</property>
    <property name="default">default</property>
  </blobdispatcher>
</extension>
```

{{/panel}}

This assumes that you have three blob providers configured, the default one and two additional ones,&nbsp;`videos`&nbsp;and&nbsp;`encrypted`. For example you could have:

{{#> panel type='code' heading='Defining Additional Binary Managers'}}

```xml
<extension target="org.nuxeo.ecm.core.blob.BlobManager" point="configuration">
  <blobprovider name="videos">
    <class>org.nuxeo.ecm.core.blob.binary.DefaultBinaryManager</class>
    <property name="path">binaries-videos</property>
  </blobprovider>
  <blobprovider name="encrypted">
    <class>org.nuxeo.ecm.core.blob.binary.AESBinaryManager</class>
    <property name="key">password=secret</property>
  </blobprovider>
</extension>
```

{{/panel}}

The default `DefaultBlobDispatcher` class can be replaced by your own implementation.


* * *

<div class="row" data-equalizer data-equalize-on="medium"><div class="column medium-6">{{#> panel heading='Related Documentation'}}

- [DefaultBinaryManager Configuration]({{page page='defaultbinarymanager-configuration'}})
- [Implementing Encryption]({{page page='implementing-encryption'}})
- [Amazon S3 Online Storage]({{page space='nxdoc710' page='amazon-s3-online-storage'}})
- [Nuxeo Live Connect]({{page space='nxdoc710' page='nuxeo-live-connect'}})

{{/panel}}</div><div class="column medium-6">

</div></div>
